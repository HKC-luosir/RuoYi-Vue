

/**
 * 计算时间差并返回文字描述
 * @param {string} timeStr - 要计算的时间字符串（格式："YYYY-MM-DD HH:mm:ss"）
 * @return {string} - 时间差的文字描述
 */
function formatTimeDiff(timeStr) {
  // 创建日期对象
  var targetDate = getDate(timeStr);
  // 获取当前时间的日期对象
  var currentDate = getDate();
  // 计算时间差（毫秒）
  var diff = currentDate - targetDate;

  if (diff < 60 * 1000) {
    return '刚刚';
  } else if (diff < 60 * 60 * 1000) {
    var minutes = Math.floor(diff / (60 * 1000));
    return minutes + "分钟前";
  } else if (diff < 24 * 60 * 60 * 1000) {
    var hours = Math.floor(diff / (60 * 60 * 1000));
    return hours + "小时前";
  } else if (diff < 30 * 24 * 60 * 60 * 1000) { // 30天内
    var days = Math.floor(diff / (24 * 60 * 60 * 1000));
    return days + "天前";
  } else if (diff < 365 * 24 * 60 * 60 * 1000) { // 1年内
    var months = Math.floor(diff / (30 * 24 * 60 * 60 * 1000));
    return months + "个月前";
  } else {
    var years = Math.floor(diff / (365 * 24 * 60 * 60 * 1000));
    return years + "年前";
  }
}

/**
 * 计算年龄
 */
function calculateAge(timeStr) {
  // 创建日期对象
  var birthdate = getDate(timeStr);
  var birthYear = birthdate.getFullYear();
  var birthMonth = birthdate.getMonth();
  var birthDay = birthdate.getDate();

  // 获取当前时间的日期对象
  var today = getDate();
  var currentYear = today.getFullYear();
  var currentMonth = today.getMonth();
  var currentDay = today.getDate();

  // 根据年份计算年龄
  var age = currentYear - birthYear;

  // 如果当前月份小于出生月份，或者当前月份等于出生月份但当前日期小于出生日期，则减去1年
  if (currentMonth < birthMonth || (currentMonth === birthMonth && currentDay < birthDay)) {
    age--;
  }
  return age;
}

module.exports = {
  formatTimeDiff: formatTimeDiff,
  calculateAge: calculateAge
}
