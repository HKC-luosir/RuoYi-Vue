<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gox.basic.mapper.FieldsItemMapper">
    <resultMap id="FieldsVo" type="com.gox.basic.domain.vo.TableFieldVo">
        <id property="id" column="id"/>
        <result property="vModel" column="v_model"/>
        <result property="flag" column="is_table_field"/>
        <result property="tableFieldSort" column="table_field_sort"/>
        <result property="tableFieldName" column="label"/>
        <result property="tableTitleWidth" column="table_title_width"/>
    </resultMap>
    <resultMap type="FieldsItem" id="FieldsItemResult">
        <result property="id" column="id"/>
        <result property="formId" column="form_id"/>
        <result property="listType" column="list_type"/>
        <result property="autoUpload" column="auto_upload"/>
        <result property="name" column="name"/>
        <result property="multiple" column="multiple"/>
        <result property="vModel" column="v_model"/>
        <result property="action" column="action"/>
        <result property="disabled" column="disabled"/>
        <result property="accept" column="accept"/>
        <result property="colorFormat" column="color_format"/>
        <result property="size" column="size"/>
        <result property="showAlpha" column="show_alpha"/>
        <result property="showText" column="show_text"/>
        <result property="showScore" column="show_score"/>
        <result property="max" column="max"/>
        <result property="allowHalf" column="allow_half"/>
        <result property="clearable" column="clearable"/>
        <result property="rangeSeparator" column="range_separator"/>
        <result property="readonly" column="readonly"/>
        <result property="startPlaceholder" column="start_placeholder"/>
        <result property="format" column="format"/>
        <result property="valueFormat" column="value_format"/>
        <result property="type" column="type"/>
        <result property="endPlaceholder" column="end_placeholder"/>
        <result property="placeholder" column="placeholder"/>
        <result property="isRange" column="is_range"/>
        <result property="min" column="min"/>
        <result property="showStops" column="show_stops"/>
        <result property="range" column="range_"/>
        <result property="step" column="step"/>
        <result property="activeText" column="active_text"/>
        <result property="activeColor" column="active_color"/>
        <result property="inactiveText" column="inactive_text"/>
        <result property="activeValue" column="active_value"/>
        <result property="inactiveValue" column="inactive_value"/>
        <result property="inactiveColor" column="inactive_color"/>
        <result property="filterable" column="filterable"/>
        <result property="showAllLevels" column="show_all_levels"/>
        <result property="separator" column="separator_"/>
        <result property="stepStrictly" column="step_strictly"/>
        <result property="precision" column="precision_"/>
        <result property="controlsPosition" column="controls_position"/>
        <result property="showWordLimit" column="show_word_limit"/>
        <result property="prefixIcon" column="prefix_icon"/>
        <result property="suffixIcon" column="suffix_icon"/>
        <result property="showPassword" column="show_password"/>
        <result property="maxlength" column="maxlength"/>
        <association property="config" select="com.gox.basic.mapper.ConfigMapper.selectConfigByItemId" column="id"/>
        <association property="slot" select="com.gox.basic.mapper.SlotMapper.selectSlotByItemId" column="id"/>
        <association property="style" select="com.gox.basic.mapper.StyleMapper.selectStyleByItemId" column="id"/>
        <association property="pickerOptions"
                     select="com.gox.basic.mapper.PickerOptionsMapper.selectPickerOptionsByItemId" column="id"/>
        <association property="props" column="id" select="com.gox.basic.mapper.PropsMapper.selectPropsByItemId"/>
        <association property="autosize" column="id"
                     select="com.gox.basic.mapper.AutosizeMapper.selectAutosizeByItemId"/>
        <collection property="options" column="id"
                    select="com.gox.basic.mapper.OptionsItemMapper.selectOptionsItemByItemId"/>
    </resultMap>
    <sql id="selectFieldsItemVo">
        select id, form_id, list_type, auto_upload, name, multiple, v_model, action, disabled, accept, color_format,
        size, show_alpha, show_text, show_score, max, allow_half, clearable, range_separator, readonly,
        start_placeholder, format, value_format, type, end_placeholder, placeholder, is_range, min, show_stops, range_,
        step, active_text, active_color, inactive_text, active_value, inactive_value, inactive_color, filterable,
        show_all_levels, separator_, step_strictly, precision_, controls_position, show_word_limit, prefix_icon,
        suffix_icon, show_password, maxlength from fields_item
    </sql>

    <select id="selectFieldsItemList" parameterType="FieldsItem" resultMap="FieldsItemResult">
        <include refid="selectFieldsItemVo"/>
        <where>
            <if test="formId != null ">and form_id = #{formId}</if>
            <if test="listType != null  and listType != ''">and list_type = #{listType}</if>
            <if test="autoUpload != null ">and auto_upload = #{autoUpload}</if>
            <if test="name != null  and name != ''">and name like concat('%', #{name}, '%')</if>
            <if test="multiple != null ">and multiple = #{multiple}</if>
            <if test="vModel != null  and vModel != ''">and v_model = #{vModel}</if>
            <if test="action != null  and action != ''">and action = #{action}</if>
            <if test="disabled != null ">and disabled = #{disabled}</if>
            <if test="accept != null  and accept != ''">and accept = #{accept}</if>
            <if test="colorFormat != null  and colorFormat != ''">and color_format = #{colorFormat}</if>
            <if test="size != null  and size != ''">and size = #{size}</if>
            <if test="showAlpha != null ">and show_alpha = #{showAlpha}</if>
            <if test="showText != null ">and show_text = #{showText}</if>
            <if test="showScore != null ">and show_score = #{showScore}</if>
            <if test="max != null ">and max = #{max}</if>
            <if test="allowHalf != null ">and allow_half = #{allowHalf}</if>
            <if test="clearable != null ">and clearable = #{clearable}</if>
            <if test="rangeSeparator != null  and rangeSeparator != ''">and range_separator = #{rangeSeparator}</if>
            <if test="readonly != null ">and readonly = #{readonly}</if>
            <if test="startPlaceholder != null  and startPlaceholder != ''">and start_placeholder =
                #{startPlaceholder}
            </if>
            <if test="format != null  and format != ''">and format = #{format}</if>
            <if test="valueFormat != null  and valueFormat != ''">and value_format = #{valueFormat}</if>
            <if test="type != null  and type != ''">and type = #{type}</if>
            <if test="endPlaceholder != null  and endPlaceholder != ''">and end_placeholder = #{endPlaceholder}</if>
            <if test="placeholder != null  and placeholder != ''">and placeholder = #{placeholder}</if>
            <if test="isRange != null ">and is_range = #{isRange}</if>
            <if test="min != null ">and min = #{min}</if>
            <if test="showStops != null ">and show_stops = #{showStops}</if>
            <if test="range != null ">and range_ = #{range}</if>
            <if test="step != null ">and step = #{step}</if>
            <if test="activeText != null  and activeText != ''">and active_text = #{activeText}</if>
            <if test="activeColor != null  and activeColor != ''">and active_color = #{activeColor}</if>
            <if test="inactiveText != null  and inactiveText != ''">and inactive_text = #{inactiveText}</if>
            <if test="activeValue != null ">and active_value = #{activeValue}</if>
            <if test="inactiveValue != null ">and inactive_value = #{inactiveValue}</if>
            <if test="inactiveColor != null  and inactiveColor != ''">and inactive_color = #{inactiveColor}</if>
            <if test="filterable != null ">and filterable = #{filterable}</if>
            <if test="showAllLevels != null ">and show_all_levels = #{showAllLevels}</if>
            <if test="separator != null  and separator != ''">and separator_ = #{separator}</if>
            <if test="stepStrictly != null ">and step_strictly = #{stepStrictly}</if>
            <if test="precision != null ">and precision_ = #{precision}</if>
            <if test="controlsPosition != null  and controlsPosition != ''">and controls_position =
                #{controlsPosition}
            </if>
            <if test="showWordLimit != null ">and show_word_limit = #{showWordLimit}</if>
            <if test="prefixIcon != null  and prefixIcon != ''">and prefix_icon = #{prefixIcon}</if>
            <if test="suffixIcon != null  and suffixIcon != ''">and suffix_icon = #{suffixIcon}</if>
            <if test="showPassword != null ">and show_password = #{showPassword}</if>
            <if test="maxlength != null  and maxlength != ''">and maxlength = #{maxlength}</if>
        </where>
    </select>

    <select id="selectFieldsItemById" parameterType="Long" resultMap="FieldsItemResult">
        <include refid="selectFieldsItemVo"/>
        where id = #{id}
    </select>
    <select id="selectFieldsItemListByFormId" resultMap="FieldsItemResult">
        <include refid="selectFieldsItemVo"/>
        where form_id=#{formId}
    </select>
    <select id="selectTableFields" resultMap="FieldsVo">
        select fi.id,fi.is_table_field,fi.table_field_sort,fi.table_title_width,c.label from fields_item fi left join
        config c on fi.id = c.item_id where fi.form_id in (select id from form_json where node_id=#{param1} and
        dept_id=#{param2})
    </select>
    <select id="selectTableTitle" resultMap="FieldsVo">
        select fi.id,fi.v_model,fi.is_table_field,fi.table_field_sort,fi.table_title_width,c.label from fields_item fi
        left join config c on fi.id = c.item_id where fi.form_id in (select id from form_json where node_id=#{param1}
        and dept_id=#{param2}) and is_table_field = 1 order by table_field_sort
    </select>

    <insert id="insertFieldsItem" parameterType="FieldsItem">
        insert into fields_item
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="formId != null">form_id,</if>
            <if test="listType != null">list_type,</if>
            <if test="autoUpload != null">auto_upload,</if>
            <if test="name != null">name,</if>
            <if test="multiple != null">multiple,</if>
            <if test="vModel != null">v_model,</if>
            <if test="action != null">action,</if>
            <if test="disabled != null">disabled,</if>
            <if test="accept != null">accept,</if>
            <if test="colorFormat != null">color_format,</if>
            <if test="size != null">size,</if>
            <if test="showAlpha != null">show_alpha,</if>
            <if test="showText != null">show_text,</if>
            <if test="showScore != null">show_score,</if>
            <if test="max != null">max,</if>
            <if test="allowHalf != null">allow_half,</if>
            <if test="clearable != null">clearable,</if>
            <if test="rangeSeparator != null">range_separator,</if>
            <if test="readonly != null">readonly,</if>
            <if test="startPlaceholder != null">start_placeholder,</if>
            <if test="format != null">format,</if>
            <if test="valueFormat != null">value_format,</if>
            <if test="type != null">type,</if>
            <if test="endPlaceholder != null">end_placeholder,</if>
            <if test="placeholder != null">placeholder,</if>
            <if test="isRange != null">is_range,</if>
            <if test="min != null">min,</if>
            <if test="showStops != null">show_stops,</if>
            <if test="range != null">range_,</if>
            <if test="step != null">step,</if>
            <if test="activeText != null">active_text,</if>
            <if test="activeColor != null">active_color,</if>
            <if test="inactiveText != null">inactive_text,</if>
            <if test="activeValue != null">active_value,</if>
            <if test="inactiveValue != null">inactive_value,</if>
            <if test="inactiveColor != null">inactive_color,</if>
            <if test="filterable != null">filterable,</if>
            <if test="showAllLevels != null">show_all_levels,</if>
            <if test="separator != null">separator_,</if>
            <if test="stepStrictly != null">step_strictly,</if>
            <if test="precision != null">precision_,</if>
            <if test="controlsPosition != null">controls_position,</if>
            <if test="showWordLimit != null">show_word_limit,</if>
            <if test="prefixIcon != null">prefix_icon,</if>
            <if test="suffixIcon != null">suffix_icon,</if>
            <if test="showPassword != null">show_password,</if>
            <if test="maxlength != null">maxlength,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="formId != null">#{formId},</if>
            <if test="listType != null">#{listType},</if>
            <if test="autoUpload != null">#{autoUpload},</if>
            <if test="name != null">#{name},</if>
            <if test="multiple != null">#{multiple},</if>
            <if test="vModel != null">#{vModel},</if>
            <if test="action != null">#{action},</if>
            <if test="disabled != null">#{disabled},</if>
            <if test="accept != null">#{accept},</if>
            <if test="colorFormat != null">#{colorFormat},</if>
            <if test="size != null">#{size},</if>
            <if test="showAlpha != null">#{showAlpha},</if>
            <if test="showText != null">#{showText},</if>
            <if test="showScore != null">#{showScore},</if>
            <if test="max != null">#{max},</if>
            <if test="allowHalf != null">#{allowHalf},</if>
            <if test="clearable != null">#{clearable},</if>
            <if test="rangeSeparator != null">#{rangeSeparator},</if>
            <if test="readonly != null">#{readonly},</if>
            <if test="startPlaceholder != null">#{startPlaceholder},</if>
            <if test="format != null">#{format},</if>
            <if test="valueFormat != null">#{valueFormat},</if>
            <if test="type != null">#{type},</if>
            <if test="endPlaceholder != null">#{endPlaceholder},</if>
            <if test="placeholder != null">#{placeholder},</if>
            <if test="isRange != null">#{isRange},</if>
            <if test="min != null">#{min},</if>
            <if test="showStops != null">#{showStops},</if>
            <if test="range != null">#{range},</if>
            <if test="step != null">#{step},</if>
            <if test="activeText != null">#{activeText},</if>
            <if test="activeColor != null">#{activeColor},</if>
            <if test="inactiveText != null">#{inactiveText},</if>
            <if test="activeValue != null">#{activeValue},</if>
            <if test="inactiveValue != null">#{inactiveValue},</if>
            <if test="inactiveColor != null">#{inactiveColor},</if>
            <if test="filterable != null">#{filterable},</if>
            <if test="showAllLevels != null">#{showAllLevels},</if>
            <if test="separator != null">#{separator},</if>
            <if test="stepStrictly != null">#{stepStrictly},</if>
            <if test="precision != null">#{precision},</if>
            <if test="controlsPosition != null">#{controlsPosition},</if>
            <if test="showWordLimit != null">#{showWordLimit},</if>
            <if test="prefixIcon != null">#{prefixIcon},</if>
            <if test="suffixIcon != null">#{suffixIcon},</if>
            <if test="showPassword != null">#{showPassword},</if>
            <if test="maxlength != null">#{maxlength},</if>
        </trim>
    </insert>
    <insert id="insertFieldsItemBatch">
        insert into fields_item (id, form_id, list_type, auto_upload, name, multiple, v_model, action, disabled, accept,
        color_format, size, show_alpha, show_text, show_score, max, allow_half, clearable, range_separator, readonly,
        start_placeholder, format, value_format, type, end_placeholder, placeholder, is_range, min, show_stops, range_,
        step, active_text, active_color, inactive_text, active_value, inactive_value, inactive_color, filterable,
        show_all_levels, separator_, step_strictly, precision_, controls_position, show_word_limit, prefix_icon,
        suffix_icon, show_password, maxlength)
        values
        <foreach collection="list" item="fi" separator="," index="index">
            (
            #{fi.id},#{fi.form_id},#{fi.list_type},#{fi.auto_upload},#{fi.name},#{fi.multiple},#{fi.v_model},#{fi.action},#{fi.disabled},#{fi.accept},#{fi.color_format},#{fi.size},#{fi.show_alpha},#{fi.show_text},#{fi.show_score},#{fi.max},#{fi.allow_half},#{fi.clearable},#{fi.range_separator},#{fi.readonly},#{fi.start_placeholder},#{fi.format},#{fi.value_format},#{fi.type},#{fi.end_placeholder},#{fi.placeholder},#{fi.is_range},#{fi.min},#{fi.show_stops},#{fi.range_},#{fi.step},#{fi.active_text},#{fi.active_color},#{fi.inactive_text},#{fi.active_value},#{fi.inactive_value},#{fi.inactive_color},#{fi.filterable},#{fi.show_all_levels},#{fi.separator_},#{fi.step_strictly},#{fi.precision_},#{fi.controls_position},#{fi.show_word_limit},#{fi.prefix_icon},#{fi.suffix_icon},#{fi.show_password},#{fi.maxlength}
            )
        </foreach>
    </insert>
    <update id="updateFieldsItem" parameterType="FieldsItem">
        update fields_item
        <trim prefix="SET" suffixOverrides=",">
            <if test="formId != null">form_id = #{formId},</if>
            <if test="listType != null">list_type = #{listType},</if>
            <if test="autoUpload != null">auto_upload = #{autoUpload},</if>
            <if test="name != null">name = #{name},</if>
            <if test="multiple != null">multiple = #{multiple},</if>
            <if test="vModel != null">v_model = #{vModel},</if>
            <if test="action != null">action = #{action},</if>
            <if test="disabled != null">disabled = #{disabled},</if>
            <if test="accept != null">accept = #{accept},</if>
            <if test="colorFormat != null">color_format = #{colorFormat},</if>
            <if test="size != null">size = #{size},</if>
            <if test="showAlpha != null">show_alpha = #{showAlpha},</if>
            <if test="showText != null">show_text = #{showText},</if>
            <if test="showScore != null">show_score = #{showScore},</if>
            <if test="max != null">max = #{max},</if>
            <if test="allowHalf != null">allow_half = #{allowHalf},</if>
            <if test="clearable != null">clearable = #{clearable},</if>
            <if test="rangeSeparator != null">range_separator = #{rangeSeparator},</if>
            <if test="readonly != null">readonly = #{readonly},</if>
            <if test="startPlaceholder != null">start_placeholder = #{startPlaceholder},</if>
            <if test="format != null">format = #{format},</if>
            <if test="valueFormat != null">value_format = #{valueFormat},</if>
            <if test="type != null">type = #{type},</if>
            <if test="endPlaceholder != null">end_placeholder = #{endPlaceholder},</if>
            <if test="placeholder != null">placeholder = #{placeholder},</if>
            <if test="isRange != null">is_range = #{isRange},</if>
            <if test="min != null">min = #{min},</if>
            <if test="showStops != null">show_stops = #{showStops},</if>
            <if test="range != null">range_ = #{range},</if>
            <if test="step != null">step = #{step},</if>
            <if test="activeText != null">active_text = #{activeText},</if>
            <if test="activeColor != null">active_color = #{activeColor},</if>
            <if test="inactiveText != null">inactive_text = #{inactiveText},</if>
            <if test="activeValue != null">active_value = #{activeValue},</if>
            <if test="inactiveValue != null">inactive_value = #{inactiveValue},</if>
            <if test="inactiveColor != null">inactive_color = #{inactiveColor},</if>
            <if test="filterable != null">filterable = #{filterable},</if>
            <if test="showAllLevels != null">show_all_levels = #{showAllLevels},</if>
            <if test="separator != null">separator_ = #{separator},</if>
            <if test="stepStrictly != null">step_strictly = #{stepStrictly},</if>
            <if test="precision != null">precision_ = #{precision},</if>
            <if test="controlsPosition != null">controls_position = #{controlsPosition},</if>
            <if test="showWordLimit != null">show_word_limit = #{showWordLimit},</if>
            <if test="prefixIcon != null">prefix_icon = #{prefixIcon},</if>
            <if test="suffixIcon != null">suffix_icon = #{suffixIcon},</if>
            <if test="showPassword != null">show_password = #{showPassword},</if>
            <if test="maxlength != null">maxlength = #{maxlength},</if>
        </trim>
        where id = #{id}
    </update>
    <update id="updateTableFieldsBatch" parameterType="arraylist">
        update fields_item
        <trim prefix="set " suffixOverrides=",">
            <trim prefix="is_table_field = case " suffix="end,">
                <foreach collection="list" item="item" index="index">
                    <if test="item.flag!=null">
                        when id=#{item.id} then #{item.flag}
                    </if>
                </foreach>
            </trim>
            <trim prefix="table_field_sort = case " suffix="end,">
                <foreach collection="list" item="item" index="index">
                    <if test="item.tableFieldSort!=null">
                        when id=#{item.id} then #{item.tableFieldSort}
                    </if>
                </foreach>
            </trim>
            <trim prefix="table_title_width = case " suffix="end,">
                <foreach collection="list" item="item" index="index">
                    <if test="item.tableTitleWidth!=null">
                        when id=#{item.id} then #{item.tableTitleWidth}
                    </if>
                </foreach>
            </trim>
        </trim>
        where
        <foreach collection="list" separator="or" item="i" index="index">
            id=#{i.id}
        </foreach>
    </update>
    <delete id="deleteFieldsItemById" parameterType="Long">
        delete from fields_item where id = #{id}
    </delete>

    <delete id="deleteFieldsItemByIds" parameterType="String">
        delete from fields_item where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    <delete id="deleteFieldsItemByFormId">
        delete from fields_item where form_id = #{id}
    </delete>

</mapper>