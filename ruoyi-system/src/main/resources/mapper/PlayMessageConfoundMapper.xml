<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.PlayMessageConfoundMapper">

    <resultMap id="BaseResultMap" type="com.ruoyi.system.domain.PlayMessageConfound">
        <id property="id" column="id" jdbcType="INTEGER"/>
        <result property="playMessageId" column="play_message_id" jdbcType="INTEGER"/>
        <result property="playId" column="play_id" jdbcType="INTEGER"/>
        <result property="groupNum" column="group_num" jdbcType="INTEGER"/>
        <result property="uuid" column="uuid" jdbcType="VARCHAR"/>
        <result property="confoundContent" column="confound_content" jdbcType="VARCHAR"/>
        <result property="momentTypeId" column="moment_type_id" jdbcType="INTEGER"/>
        <result property="state" column="state" jdbcType="INTEGER"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="modifyTime" column="modify_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id
        ,play_message_id,play_id,
        group_num,confound_content,moment_type_id,`state`,uuid,
        create_time,modify_time
    </sql>

    <select id="selectConfusionStateStatistics"
            resultType="com.ruoyi.system.domain.vo.PlayMessageConfusionStateVO">
        SELECT
            tpmc.id AS confoundId,
            tpmc.state,
            count( tpmc.id ) AS total,
            sum( IF ( tpmcl.state = 1, 1, 0 ) ) AS successCount
        FROM
            t_play_message_confound tpmc
            INNER JOIN t_play_message_confound_log tpmcl ON tpmc.id = tpmcl.message_confound_id
            AND tpmc.state IN ( 0, 2 )
            AND tpmc.create_time > ADDDATE( NOW( ),- 3 )
        GROUP BY
            tpmc.id;
    </select>
</mapper>
