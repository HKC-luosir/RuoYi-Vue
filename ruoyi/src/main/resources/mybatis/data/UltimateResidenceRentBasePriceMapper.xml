<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.project.data.price.mapper.UltimateResidenceRentPriceMapper">

    <resultMap type="com.ruoyi.project.data.price.domain.UltimateResidenceRentBasePrice"
               id="MappingResult">
        <result property="id" column="id"/>
        <result property="communityId" column="projectID"/>
        <result property="priceType" column="priceType"/>
        <result property="basePrice_1" column="basePrice_1"/>
        <result property="rentPrice" column="rentPrice"/>
        <result property="sumCase1" column="sumCase1"/>
        <result property="voppa" column="voppa"/>
        <result property="voppat" column="voppat"/>
        <result property="gf_1Room" column="gf_1Room"/>
        <result property="gf_2Room" column="gf_2Room"/>
        <result property="gy_2Room" column="gy_2Room"/>
        <result property="gy_3Room" column="gy_3Room"/>
        <result property="one_Room" column="one_Room"/>
        <result property="two_Room" column="two_Room"/>
        <result property="three_Room" column="three_Room"/>
        <result property="entireRentRatio" column="entireRentRatio"/>
        <result property="entireRentNum" column="entireRentNum"/>
        <result property="shareRentRatio" column="shareRentRatio"/>
        <result property="shareRentNum" column="shareRentNum"/>
        <result property="saleRentRatio" column="saleRentRatio"/>
        <result property="status" column="status"/>
        <result property="adjEvd" column="adjEvd"/>
        <result property="modifyDate" column="modifyDate"/>
    </resultMap>

    <sql id="selectAllColumn">
        select
        ID,ProjectID,PriceType,BasePrice_1,RentPrice,SumCase1,VOPPAT,VOPPA,GF_1Room,GF_2Room,GY_2Room,GY_3Room,One_Room,Two_Room,Three_Room,EntireRentRatio,EntireRentNum,ShareRentRatio,ShareRentNum,SaleRentRatio,ModifyDate,Status,AdjEvd
        from ODS_PROJECT_RENT_PRICE_INFO_${yearMonth}
    </sql>

    <select id="selectPageCount" parameterType="com.ruoyi.project.data.price.domain.UltimateResidenceRentBasePrice" resultType="int">
        select count(1) from ODS_PROJECT_RENT_PRICE_INFO_${yearMonth}
        <where>
            <if test="communityId != null">
                AND ProjectID = #{communityId}
            </if>
            <if test="status != null">
                AND Status = #{status}
            </if>
        </where>
    </select>

    <select id="selectPageList" parameterType="com.ruoyi.project.data.price.domain.UltimateResidenceRentBasePrice"
            resultMap="MappingResult">
        <include refid="selectAllColumn"/>
        <where>
            <if test="communityId != null">
                AND ProjectID = #{communityId}
            </if>
            <if test="status != null">
                AND Status = #{status}
            </if>
        </where>
        order by ProjectID ASC, status DESC OFFSET #{pageIndex} rows fetch next #{pageSize} rows only;
    </select>

    <select id="yearMonthList" resultType="com.ruoyi.project.common.VueSelectModel">
        SELECT right(name,6) as value, right(name,6) as label
        FROM sys.tables
        where name like 'ODS_PROJECT_RENT_PRICE_INFO_%' and name not like '%_bak'
        order by cast(right(name,6) as int) desc
    </select>
</mapper>