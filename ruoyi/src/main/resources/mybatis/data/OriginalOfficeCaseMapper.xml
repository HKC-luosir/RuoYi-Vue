<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.project.data.cases.mapper.OriginalOfficeCaseMapper">
    <update id="createTable">
        <bind name="targetTableName" value="'dbo.ODS_OFFICECASELISTED_' + yearMonth + '_RAW'"/>
        IF OBJECT_ID(#{targetTableName}, 'U') IS NOT NULL
            drop table ${targetTableName};

        create TABLE ${targetTableName}
        (
            case_id varchar(32) not null primary key,
            url varchar (1000) NULL,
            title varchar (1000) NULL,
            容积率 varchar (1000) NULL,
            总价售 varchar (1000) NULL,
            均价售 varchar (1000) NULL,
            楼盘名称 varchar (1000) NULL,
            楼盘名称_M nvarchar (512) NULL,
            楼层 varchar (1000) NULL,
            面积 varchar (1000) NULL,
            物业费 varchar (1000) NULL,
            工位数 varchar (1000) NULL,
            地址 varchar (1000) NULL,
            地铁 varchar (1000) NULL,
            发布时间 date NULL,
            房源编号 varchar (1000) NULL,
            百度lng varchar (1000) NULL,
            百度lat varchar (1000) NULL,
            区域 varchar (1000) NULL,
            分类 varchar (1000) NULL,
            来源 varchar (1000) NULL,
            等级 varchar (1000) NULL,
            楼盘网址 varchar (1000) NULL,
            装修 varchar (1000) NULL,
            类型 varchar (1000) NULL,
            板块 varchar (1000) NULL,
            挂牌中介 varchar (1000) NULL,
            月租金租 varchar (1000) NULL,
            标准租金租 varchar (1000) NULL,
            更新时间 date NULL,
            得房率 varchar (1000) NULL,
            总价 decimal (18, 2) NULL,
            单价 decimal (18, 2) NULL
        );
    </update>
    <!--  创建人工修正表  -->
    <update id="createArtificialTable">
        <bind name="targetTableName" value="'dbo.DWA_PROJECTBASEPRICE_OFFICE_MANU_' + yearMonth"/>
        IF OBJECT_ID(#{targetTableName}, 'U') IS NOT NULL
            drop table ${targetTableName};

        create table ${targetTableName}
        (
            id int not null,
            BuildingID_P nvarchar(20) not null,
            ProjectID_P nvarchar(20) null,
            ProjectName nvarchar(200) null,
            ProjectAddr nvarchar(200) null,
            BuildingAddr nvarchar(200) null,
            County nvarchar(200) null,
            Loop nvarchar(200) null,
            Block nvarchar(200) null,
            Street nvarchar(200) null,
            Year int null,
            AvgArea decimal(10, 2) null,
            TotalFloorSum nvarchar(50) null,
            UpperFloorSum nvarchar(50) null,
            OfficeClass nvarchar(50) null,
            Grade nvarchar(50) null,
            MainPrice_1 decimal(18, 6) null,
            MainPriceRent_1 decimal(18, 6) null,
            MainPrice decimal(38, 6) null,
            MainPriceRent decimal(38, 6) null,
            MainPricePst decimal(38, 6) null,
            MainPriceRentPst decimal(38, 6) null,
            MainPriceType varchar(2) null,
            MainPriceRentType varchar(2) null,
            AreaCoff decimal(18, 6) null,
            YearCoff decimal(18, 6) null,
            BuildingCoff decimal(18, 6) null,
            BuildingStd bit null,
            AdjEvd nvarchar(1000) null,
            ModifyDate date not null
        );
    </update>
    <!--案例汇总表-->
    <update id="createAssembleTable">
        <bind name="targetTableName" value="'dbo.DW_OFFICECASE_COMM_' + yearMonth"/>
        IF OBJECT_ID(#{targetTableName}, 'U') IS NOT NULL
            drop table ${targetTableName};

        CREATE TABLE ${targetTableName}
        (
            ID uniqueidentifier NOT NULL,
            url varchar (1000) NULL,
            title varchar (1000) NULL,
            容积率 varchar (1000) NULL,
            总价售 varchar (1000) NULL,
            均价售 varchar (1000) NULL,
            楼盘名称 varchar (1000) NULL,
            楼盘名称_M nvarchar (512) NULL,
            楼层 varchar (1000) NULL,
            面积 varchar (1000) NULL,
            物业费 varchar (1000) NULL,
            工位数 varchar (1000) NULL,
            地址 varchar (1000) NULL,
            地铁 varchar (1000) NULL,
            发布时间 date NULL,
            房源编号 varchar (1000) NULL,
            百度lng varchar (1000) NULL,
            百度lat varchar (1000) NULL,
            区域 varchar (1000) NULL,
            分类 varchar (1000) NULL,
            来源 varchar (1000) NULL,
            等级 varchar (1000) NULL,
            楼盘网址 varchar (1000) NULL,
            装修 varchar (1000) NULL,
            类型 varchar (1000) NULL,
            板块 varchar (1000) NULL,
            挂牌中介 varchar (1000) NULL,
            月租金租 varchar (1000) NULL,
            标准租金租 varchar (1000) NULL,
            更新时间 varchar (1000) NULL,
            得房率 varchar (1000) NULL,
            总价 decimal (18, 2) NULL,
            单价 decimal (18, 2) NULL,
            BuildingID_P bigint NULL,
            ProjectID_P bigint NULL,
            TotalFloorSum nvarchar (32) NULL,
            FloorCoff decimal (7, 4) NULL,
            DecorationCoff decimal (7, 4) NULL,
            PriceAmend numeric (38, 12) NULL,
            MainPrice_1 decimal (38, 6) NULL,
            MainPriceRent_1 decimal (38, 6) NULL,
            ListedPrice_1 decimal (38, 6) NULL,
            ListedPriceRent_1 decimal (38, 6) NULL,
            ListedPrice decimal (38, 6) NULL,
            ListedPriceRent decimal (38, 6) NULL,
            VOPP numeric (38, 6) NULL,
            VOPPT nvarchar (32) NULL
        )
    </update>
    <!--  初始化汇总表-->
    <update id="initAssembleTable">
        <bind name="targetTableName" value="'dbo.DW_OFFICECASE_COMM_' + yearMonth"/>
        IF OBJECT_ID(#{targetTableName}, 'U') IS NOT NULL
            drop table ${targetTableName};
    </update>
    <!--  初始化汇总表-->
    <update id="initPriceTable">
        <bind name="targetTableName" value="'dbo.ODS_OFFICE_BUILDING_PRICE_INFO_' + yearMonth"/>
        IF OBJECT_ID(#{targetTableName}, 'U') IS NOT NULL
            drop table ${targetTableName};
    </update>
    <!-- 汇总案例 -->
    <select id="getOfficeAggregationCases" resultType="com.ruoyi.project.data.cases.domain.OfficeAggregationCase">
        SELECT url as url
              ,title as title
              ,容积率 as floorAreaRatio
              ,总价售 as caseTotalPrice
              ,均价售 as caseUnitPrice
              ,楼盘名称 as name
              ,楼盘名称_M as name_m
              ,楼层 as caseFloor
              ,面积 as area
              ,物业费 as managementFee
              ,工位数 as seatCount
              ,地址 as address
              ,地铁 as metro
              ,发布时间 as publishDate
              ,房源编号 as sourceNo
              ,百度lng as lng
              ,百度lat as lat
              ,区域 as county
              ,分类 as catalog
              ,来源 as source
              ,等级 as level
              ,楼盘网址 as homePageUrl
              ,装修 as decoration
              ,类型 as type
              ,板块 as block
              ,挂牌中介 as agency
              ,月租金租 as rentOfMonthly
              ,标准租金租 as rentOfStandard
              ,更新时间 as updateDate
              ,得房率 as score
              ,总价 as totalPrice
              ,单价 as unitPrice
              ,BuildingID_P as buildingId
              ,ProjectID_P as communityId
              ,TotalFloorSum as totalFloor
              ,FloorCoff as floorCoefficient
              ,DecorationCoff as decorationCoefficient
              ,PriceAmend as priceAmend
              ,MainPrice_1 as mainPrice_1
              ,MainPriceRent_1 as mainPriceRent_1
              ,ListedPrice_1 as listedPrice_1
              ,ListedPriceRent_1 as listedPriceRent_1
              ,ListedPrice as listedPrice
              ,ListedPriceRent as listedPriceRent
              ,VOPP as vopp
              ,VOPPT as voppt
          FROM dbo.DW_OFFICECASE_COMM_${yearMonth}
    </select>
</mapper>